<html>

<head>
  <script src="https://unpkg.com/@webex/embedded-app-sdk@latest" defer></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@1.0.4/css/bulma.min.css">
  <script src="https://kit.fontawesome.com/f4a0e6453b.js" crossorigin="anonymous"></script>
  <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tom-select/dist/css/tom-select.css">
  <script src="https://cdn.jsdelivr.net/npm/tom-select/dist/js/tom-select.complete.min.js"></script>
  <style>
    .column.is-centered {
      display: flex;
      justify-content: center;
    }

    .custom-cell {
      line-height: 40px;
    }

    .row-item {
      background-color: white;
    }

    body {
      height: 100%;
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
    }

    .theme-light {
      background-color: white;
    }
    #call-log-scroll-container {
      max-height: 400px;       /* vertical scroll height */
      overflow-y: auto;        /* vertical scroll */
      overflow-x: auto;        /* horizontal scroll */
      width: 100%;
      display: block;
    }

  </style>
</head>

<body>
  <!-- this is the first page you see difference in the settings button for admin or agent -->
  <div id="header-box" class="columns is-centered is-info mt-0">
    <div class="column is-1 is-centered py-2">
      <div class="dropdown is-left is-active">
        <div class="dropdown-trigger">
          <!-- settings gear button -->
          <!-- this is shown for admins else not- from config.js -->
          <button id="settings-button" class="button" aria-haspopup="true" aria-controls="theme-menu"
            style="display:none;">
            <span class="icon">
              <i class="fas fa-gear" aria-hidden="true"></i>
            </span>
          </button>
        </div>
        <!-- settings dropdown menu -->
        <div class="dropdown-menu" id="settings-menu" role="menu" style="display:none;">
          <div id="settings-menu-content" class="dropdown-content">
          </div>
        </div>
      </div>
    </div>
    <div class="column is-3 is-centered py-0">
      <div class="column is-narrow is-centered py-2">
        <figure class="image">
          <img id="logo" style="border-radius:10px;"></img>
        </figure>
      </div>
    </div>
    <div class="column is-centered py-2">
      <h1 id='main-title' class="title"></h1>
    </div>
    <div class="column is-1 is-centered py-0"></div>
    <div class="column is-2 is-centered py-2">
      <button class="button is-static">
        <span class="icon">
          <i class="fas fa-phone" aria-hidden="true"></i>
        </span>
        <span id="main-state">Ready</span>
      </button>
    </div>
    <div class="column is-1 is-centered py-2 mx-5">
      <div class="dropdown is-right is-active">
        <div class="dropdown-trigger">
          <button id="theme-button" class="button" aria-haspopup="true" aria-controls="theme-menu">
            <span>Theme</span>
            <span class="icon is-small">
              <i class="fas fa-palette" aria-hidden="true"></i>
            </span>
          </button>
        </div>
        <div class="dropdown-menu" id="theme-menu" role="menu" style="display:none;">
          <div class="dropdown-content">
            <a id="light-blue" href="#" class="dropdown-item is-selected"
              style="color: hsl(var(--bulma-info-h),var(--bulma-info-s),var(--bulma-info-l))!important;background-color:white;"><span>Light
                Blue</span></a>
            <a id="dark-blue" href="#" class="dropdown-item has-background-black-ter"
              style="color: hsl(var(--bulma-info-h),var(--bulma-info-s),var(--bulma-info-l))!important;"><span>Dark
                Blue</span></a>
            <a id="light-orange" href="#" class="dropdown-item"
              style="color:#ff7900;background-color:white;"><span>Light Orange</span></a>
            <a id="dark-orange" href="#" class="dropdown-item has-background-black-ter" style="color:#ff7900"><span>Dark
                Orange</span></a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="columns is-centered mb-0">
    <div class="column is-three-quarters">
      <article class="message is-info">
        <div id="call-behavior-message" class="message-body" style="display:none;"></div>
      </article>
    </div>
  </div>
  <div id="script-div" class="notification mx-5">
    <h2 id="script" class="subtitle is-3"></h2>
  </div>
  <!-- this section is shown when a call comes in ,and a queue exists,the data within this is built by buildCompany and buildContacts  -->
  <div id="main-content" style="display:none;">
    <div class="mx-5">
      <h2 class="subtitle is-4">Company Profile</h2>
      <div class="columns ml-0">
        <div class="column is-two-fifths">
          <div id="first-column" class="columns is-multiline">
          </div>
        </div>
        <div class="column is-three-fifths">
          <div id="second-column" class="columns is-multiline">
          </div>
        </div>
      </div>
    </div>
    
    <div class="mx-5 mt-6">
      <h2 class="subtitle is-4 my-1">Company Contacts</h2>
      <div id="actions">
        <table class="table">
          <tbody id="contacts">
          </tbody>
        </table>
      </div>
    </div>
    <button id="open-call-log-modal" class=" mx-5 button is-primary mb-3">
      Add Call Log
    </button>
    <div class="mx-5 mt-6">
      <h2 class="subtitle is-4 my-1">Call Logs</h2>
      <div id="call-logs-table">
        <table class="table">
          <thead>
            <tr>
              <th> </th>
              <th>Call Type</th>
              <th>Company Contact</th>
              <th>Reason For Call</th>
              <th>Call Back Number</th>
              <th>Caller name</th>
              <th>Caller Company</th>
              <th>Caller Email</th>
              <th>Timestamp</th>
            </tr>
          </thead>
          <tbody id="call-logs">
          </tbody>
        </table>
      </div>
    </div>
  </div>
  <!-- this section is shown when a call comes in ,and a queue does not exist , only customer data exits built by buildCustomer -->
  <div class="columns is-centered mb-0">
    <div class="column is-three-quarters">
      <article id="caller-info" class="" style="display:none;">
        <div class="message-header">
          <p>Caller Information</p>
          <button id="delete-caller-info" class="delete" aria-label="delete"></button>
        </div>
        <nav class="panel">
          <a class="panel-block row-item">
            <span class="panel-icon">
              <i class="fas fa-hashtag" aria-hidden="true"></i>
            </span>
            <p id="call-id">CallId</p>
          </a>
          <a class="panel-block row-item is-active">
            <span class="panel-icon">
              <i class="fas fa-phone" aria-hidden="true"></i>
            </span>
            <p id="caller-id">CallerId</p>
          </a>
          <a class="panel-block row-item">
            <span class="panel-icon">
              <i class="fas fa-table-list" aria-hidden="true"></i>
            </span>
            <p id="call-type">CallType</p>
          </a>
          <a class="panel-block row-item">
            <span class="panel-icon">
              <i class="fas fa-bookmark" aria-hidden="true"></i>
            </span>
            <p id="call-state">CallState</p>
          </a>
        </nav>
      </article>
    </div>
  </div>
  <div id="api-info-div" class="columns is-centered" style="display:none;">
    <div class="column is-three-quarters">
      <article id="api-info" class="">
        <div class="message-header">
          <p id="api-title">API / DB Information (Caller)</p>
          <button id="delete-api-info" class="delete" aria-label="delete"></button>
        </div>
        <nav class="panel">
          <a id="api-name" class="panel-block row-item">
            <span class="panel-icon">
              <i class="fas fa-address-card" aria-hidden="true"></i>
            </span>
            <p id="api-name-text">Name</p>
          </a>
          <a id="api-email" class="panel-block row-item">
            <span class="panel-icon">
              <i class="fas fa-regular fa-envelope" aria-hidden="true"></i>
            </span>
            <p id="api-email-text">Email</p>
          </a>
          <a id="api-company" class="panel-block row-item">
            <span class="panel-icon">
              <i class="fas fa-regular fa-building" aria-hidden="true"></i>
            </span>
            <p id="api-company-text">Company</p>
          </a>
          <a id="api-link" class="panel-block row-item" style="display: none;">
            <span class="panel-icon">
              <i class="fas fa-regular fa-link" aria-hidden="true"></i>
            </span>
            <p id="api-link-text">Link</p>
          </a>
        </nav>
      </article>
    </div>
  </div>

  <!-- opens when there is an error . the text inputted here is the error -->
  <div id="modal-error" class="modal">
    <div class="modal-background"></div>
    <div class="modal-card">
      <header class="modal-card-head py-4">
        <p class="modal-card-title has-text-danger">Error!</p>
        <button id="modal-error-close" class="delete close" aria-label="close"></button>
      </header>
      <section class="modal-card-body">
        <p id="modal-error-text" class="modal-card-title"></p>
      </section>
      <footer class="modal-card-foot py-4">
        <div class="buttons">
          <button id="modal-error-close-lower" class="button close">Close</button>
        </div>
      </footer>
    </div>
  </div>
  <!-- opens when the button modal-settings-delete in the admin modal footer is clicked -->
  <div id="modal-delete-confirm" class="modal" style="z-index:10;">
    <div class="modal-background"></div>
    <div class="modal-card" style="overflow:visible;">
      <header class="modal-card-head py-4">
        <p class="modal-card-title has-text-warning">Warning</p>
        <button id="modal-delete-confirm-close" class="delete close" aria-label="close"></button>
      </header>
      <section class="modal-card-body">
        <p id="modal-delete-confirm-text" class="modal-card-title"></p>
      </section>
      <footer class="modal-card-foot py-2">
        <div class="columns" style="width:100%;">
          <div class="column is-4 pr-0">
            <button id="modal-delete-confirm-delete" class="button is-danger">Delete</button>
            <button id="modal-delete-confirm-close-lower" class="button close">Cancel</button>
          </div>
          <div id="modal-delete-confirm-error" class="column is-8 has-text-danger has-text-weight-medium mt-2">
          </div>
        </div>
      </footer>
    </div>
  </div>
  <!-- admin modal which pops from the settings menu -->
  <div id="modal-settings" class="modal" style="z-index:0;">
    <div class="modal-background"></div>
    <div class="modal-card" style="width:97%;">
      <header class="modal-card-head py-2">
        <p class="modal-card-title">Admin</p>
        <button id="modal-settings-close" class="delete close" aria-label="close"></button>
      </header>
      <section class="modal-card-body">
        <div class="mx-5">
          <h2 class="subtitle is-4">Company Profile</h2>
          <div id="script-settings-div" class="columns ml-0 mb-6"></div>
          <div class="columns ml-0">
            <div class="column is-two-fifths">
              <div id="first-column-settings" class="columns is-multiline">
              </div>
            </div>
            <div class="column is-three-fifths">
              <div id="second-column-settings" class="columns is-multiline">
              </div>
            </div>
          </div>
          <button id="edit-profile-button" class="button is-info mr-3">
              Edit Profile
          </button>
        </div>
        <div class="mx-5 mt-6">
          <h2 class="subtitle is-4 my-1">Company Contacts</h2>
          <!-- search bar -->
          <div class="field" style="margin-bottom: 15px;">
              <div class="control has-icons-left">
                  <input id="contact-search" class="input" type="text" placeholder="Search contacts...">
                  <span class="icon is-left">
                      <i class="fas fa-search"></i>
                  </span>
              </div>
          </div>
          <div id="actions-settings">
            <table class="table mb-1 is-bordered is-fullwidth">
              <thead>
                <tr>
                  <th></th>
                  <th style="background-color:grey;">Name</th>
                  <th style="background-color:grey;">Agent instructions</th>
                  <th style="background-color:grey;">Transfer Number</th>
                  <th style="background-color:grey;">Voicemail</th>
                  <th style="background-color:grey;">View</th>
                  <th style="background-color:grey;">Edit</th>
                </tr>
              </thead>
              <tbody id="contacts-settings">
              </tbody>
            </table>
            <button id="action-add" class="button ml-3">
              <span class="icon"><i class="fas fa-plus" aria-hidden="true"></i></span>
          </div>
        </div>
        <br>
        <div class="mx-5 mt-6">
          <button id="open-subform" class="button is-primary mb-3">
            Add Call Log
          </button>
          <h2 class="subtitle is-4 my-1">Call Logs</h2>
          <div id="callog-settings-table">
            <div id="call-log-scroll-container">
              <table class="table is-bordered is-fullwidth">
                <thead>
                  <tr>
                    <th style="background-color:grey;">Timestamp</th>
                    <th style="background-color:grey;">Agent</th>
                    <th style="background-color:grey;">Call Type</th>
                    <th style="background-color:grey;">Recipient</th>
                    <th style="background-color:grey;">Reason For Call</th>
                    <th style="background-color:grey;">Caller name</th>
                    <th style="background-color:grey;">Caller Company</th>
                    <th style="background-color:grey;">Call Back Number</th>
                    <th style="background-color:grey;">Caller Email</th>
                    <th style="background-color:grey;">Details</th>
                  </tr>
                </thead>

                <tbody id="call-log-settings">
                  <!-- Your dynamic rows will fill here -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </section>
      <footer class="modal-card-foot py-2">
        <div class="columns" style="width:100%;">
          <div class="column is-3 pr-0">
            <button id="modal-settings-save" class="button is-info">Save</button>
            <button id="modal-settings-close-lower" class="button close">Cancel</button>
          </div>
          <div id="modal-settings-error" class="column is-5 has-text-weight-medium mt-2 pl-0">
          </div>
          <div class="column is-2"></div>
          <div class="column is-2">
            <button id="modal-settings-delete" class="button is-danger">Delete Profile</button>
          </div>
        </div>
      </footer>
    </div>
  </div>

  <!-- EDIT COMPANY PROFILE MODAL -->
  <div id="modal-profile-edit" class="modal">
    <div class="modal-background"></div>
    <div class="modal-card" style="width:80%;">
      
      <header class="modal-card-head">
        <p class="modal-card-title">Edit Company Profile</p>
        <button class="delete close-edit-profile" aria-label="close"></button>
      </header>

      <section class="modal-card-body">
        <div id="profile-edit-container"></div>
      </section>

      <footer class="modal-card-foot">
        <button id="save-profile-edit" class="button is-info">Update Changes</button>
        <button class="button close-edit-profile">Cancel</button>
      </footer>

    </div>
  </div>


  <!-- add contact modal -->
  <div id="add-contact-modal" class="modal">
    <div class="modal-background"></div>

    <div class="modal-card" style="width: 70%;">
      <!-- HEADER -->
      <header class="modal-card-head">
        <p class="modal-card-title">Add company contact</p>
        <button class="delete" aria-label="close" id="close-contact-modal"></button>
      </header>

      <!-- BODY -->
      <section class="modal-card-body">
        <div class="columns">

          <!-- LEFT SIDE -->
          <div class="column">
            <div class="field">
              <label class="label">Name</label>
              <input id="contact-name"class="input" type="text" placeholder="Name">
            </div>

            <div class="field">
              <label class="label">Department</label>
              <input id="contact-dept" class="input" type="text" placeholder="Department">
            </div>

            <div class="field">
              <label class="label">Answering Mode</label>
              <div class="select is-fullwidth">
                <select id="contact-answer-mode">
                  <option>Select...</option>
                  <option>Cold Transfer</option>
                  <option>Send Voicemail</option>
                  <option>Take Message</option>
                  <option>Warm Transfer</option>
                </select>
              </div>
            </div>

            <div class="field">
              <label class="label">Transfer Phone</label>
              <div class="select is-fullwidth">
                <select id="contact-transfer-phone">
                  <option>Select...</option>
                  <option>Office Phone</option>
                  <option>Cell Phone</option>
                  <option>Home Phone</option>
                  <option>Other Phone</option>
                </select>
              </div>
            </div>

            <div class="field">
              <label class="label">Custom Instructions</label>
              <textarea id="contact-instructions" class="textarea" placeholder="Write instructions..."></textarea>
            </div>
          </div>

          <!-- RIGHT SIDE -->
          <div class="column">
            <div class="field">
              <label class="label">Email</label>
              <input id="contact-email" class="input" type="email" placeholder="Email">
            </div>

            <div class="field">
              <label class="label">Office Phone</label>
              <input id="contact-office" class="input" type="text" placeholder="Office Phone">
            </div>

            <div class="field">
              <label class="label">Cell Phone</label>
              <input id="contact-cell" class="input" type="text" placeholder="Cell Phone">
            </div>

            <div class="field">
              <label class="label">Home Phone</label>
              <input id="contact-home" class="input" type="text" placeholder="Home Phone">
            </div>

            <div class="field">
              <label class="label">Other Phone</label>
              <input id="contact-other" class="input" type="text" placeholder="Other Phone">
            </div>
          </div>

        </div>
      </section>

      <!-- FOOTER -->
      <footer class="modal-card-foot" style="justify-content: flex-start;">
        <button id="save-contact-button" class="button is-primary">Add Contact</button>
      </footer>

    </div>
  </div>


  <!--- SUBFORM POPUP MODAL --->

  <div id="modal-subform" class="modal">
    <div class="modal-background"></div>

    <div class="modal-card" style="width: 50%; max-width: 700px;">
      <header class="modal-card-head">
        <p class="modal-card-title">Add Call Log</p>
        <button id="modal-subform-close" class="delete"></button>
      </header>

      <section class="modal-card-body">

        <!-- Company Details -->

        <div class="box" style="margin-bottom: 25px;">
          <h2 class="title is-5">Company Details</h2>
          <div class="field">
            <label class="label">Company Name</label>
            <input id="companyName" class="input" type="text" value=" " disabled>
          </div>
        </div>

        <!-- Add Call Log -->

        <h2 class="title is-5">Add Call Log</h2>

        <div class="columns is-multiline">

          <div class="column is-half">
            <div class="field">
              <label class="label">Call Type *</label>
              <div class="select is-fullwidth">
                <select id="callType">
                  <option value="">Select...</option>
                  <option value="Take Message">Take Message</option>
                  <option value="Send to Voicemail">Send to Voicemail</option>
                  <option value="Transfer">Transfer</option>
                  <option value="Sales Call">Sales Call</option>
                  <option value="Test Call">Test Call</option>
                  <option value="No Further Action">No Further Action</option>
                </select>
              </div>
            </div>
          </div>

          <div class="column is-half">
            <div class="field">
              <label class="label">Callback Number</label>
              <input id="callbackNumber" class="input" type="text">
            </div>
          </div>

          <div class="column is-half">
            <div class="field">
              <label class="label">Company Contact</label>
              <div class="select is-fullwidth">
                <select id="companyContact" multiple placeholder="Select contacts..." autocomplete="off">
                  <option value="">Select</option>
                </select>
              </div>
            </div>
          </div>

          <div class="column is-half">
            <div class="field">
              <label class="label">Caller Name</label>
              <input id="callerName" class="input" type="text">
            </div>
          </div>

          <!-- <div class="column is-half">
            <div class="field">
              <label class="label">Reason for Call</label>
              <textarea id="reasonForCall" class="textarea"></textarea>
            </div>
          </div> -->

          <div class="column is-half">
            <div class="field">
              <label class="label">Reason for Call</label>

              <!-- Quill Editor -->
              <div id="reasonForCallEditor" style="height: 200px; background: white;"></div>

              <!-- Hidden input to store final HTML -->
              <input type="hidden" id="reasonForCall">
            </div>
          </div>

          <div class="column is-half">
            <div class="field">
              <label class="label">Caller Company</label>
              <input id="callerCompany" class="input" type="text">
            </div>

            <div class="field" style="margin-top: 15px;">
              <label class="label">Caller Email</label>
              <input id="callerEmail" class="input" type="email">
            </div>
          </div>

        </div>

      </section>

      <footer class="modal-card-foot" style="justify-content: flex-start;">
        <button id="modal-subform-save" class="button" style="background:#cc0000; color:white;">
          Submit
        </button>
        <button id="modal-subform-close-lower" class="button">Cancel</button>
      </footer>
    </div>
  </div>

  <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

  <script>
    // Initialize Quill
    var quill = new Quill('#reasonForCallEditor', {
      theme: 'snow',
      placeholder: 'Enter the reason for call...',
      modules: {
        toolbar: [
          ['bold', 'italic', 'underline'],
          [{ 'list': 'ordered' }, { 'list': 'bullet' }],
          ['clean']
        ]
      }
    });

    // On submit
    document.getElementById('modal-subform-save').addEventListener('click', function () {
      // Put Quill HTML into hidden input
      document.getElementById('reasonForCall').value = quill.root.innerHTML;

      console.log("Saved HTML:", document.getElementById('reasonForCall').value);

      // Now continue your existing submit logic
    });
  </script>

</body>
<script crossorigin src="https://unpkg.com/webex@^3/umd/webex.min.js"></script>
<script crossorigin src="https://cdn.jsdelivr.net/npm/webex@3.7.0/umd/webex.min.js"></script>
<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script>
<script src="https://code.jquery.com/jquery-3.7.0.min.js"
  integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g=" crossorigin="anonymous"></script>
<script type="text/javascript" src="js/config.js" defer></script>
<script type="text/javascript" src="js/calling_functions.js" defer></script>
<script type="text/javascript" src="js/ea_functions.js" defer></script>
<script type="text/javascript" src="js/functions.js" defer></script>
<script type="text/javascript" src="js/index.js" defer></script>

</html>